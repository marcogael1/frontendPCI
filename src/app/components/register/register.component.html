<div class="flex justify-center items-start min-h-screen">
  <div class="w-full max-w-md bg-white p-8 rounded-lg shadow-lg mt-10 ">
    <h2 class="text-3xl font-bold text-center text-pci-blue mb-6">Registrarse</h2>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <div class="mb-4">
        <label class="block text-pci-blue font-bold mb-2" for="username">Nombre de usuario</label>
        <input
          formControlName="username"
          id="username"
          type="text"
          placeholder="Nombre de usuario"
          class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-pci-blue"
        />
        <div *ngIf="f['username'].invalid && f['username'].touched" class="text-red-500 mt-1">
          <small *ngIf="f['username'].errors?.['required']">El nombre de usuario es obligatorio.</small>
          <small *ngIf="f['username'].errors?.['minlength']">Debe tener al menos 4 caracteres.</small>
          <small *ngIf="f['username'].errors?.['pattern']">Solo se permiten letras, números y guiones bajos.</small>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-pci-blue font-bold mb-2" for="email">Correo Electrónico</label>
        <input
          formControlName="email"
          id="email"
          type="email"
          placeholder="Correo electrónico"
          class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-pci-blue"
        />
        <div *ngIf="f['email'].invalid && f['email'].touched" class="text-red-500 mt-1">
          <small *ngIf="f['email'].errors?.['required']">El correo electrónico es obligatorio.</small>
          <small *ngIf="f['email'].errors?.['email']">Debe ser un correo válido.</small>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-pci-blue font-bold mb-2" for="password">Contraseña</label>
        <div class="relative">
          <input
            formControlName="password"
            id="password"
            [type]="showPassword ? 'text' : 'password'"
            placeholder="Contraseña"
            class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-pci-blue"
            (input)="onPasswordInput()"
          />
          <button
            type="button"
            class="absolute right-2 top-2 text-gray-500 hover:text-gray-700 focus:outline-none"
            (click)="togglePasswordVisibility('password')"
          >
            <fa-icon [icon]="showPassword ? faEyeSlash : faEye"></fa-icon>
          </button>
        </div>

        <div class="relative h-2 mt-2 rounded bg-gray-300">
          <div class="h-2 rounded" [ngClass]="passwordStrengthClass" [style.width.%]="passwordStrengthPercentage"></div>
        </div>
        <div class="text-sm mt-1">
          <small [ngClass]="passwordStrengthClassText">{{ passwordStrengthText }}</small>
        </div>
      </div>

      <ul class="mt-2 text-sm">
        <li [ngClass]="{ 'text-green-500': passwordRequirements.length, 'text-red-500': !passwordRequirements.length }">
          <small>Debe tener al menos 8 caracteres</small>
        </li>
        <li [ngClass]="{ 'text-green-500': passwordRequirements.uppercase, 'text-red-500': !passwordRequirements.uppercase }">
          <small>Debe tener al menos una letra mayúscula (A-Z)</small>
        </li>
        <li [ngClass]="{ 'text-green-500': passwordRequirements.lowercase, 'text-red-500': !passwordRequirements.lowercase }">
          <small>Debe tener al menos una letra minúscula (a-z)</small>
        </li>
        <li [ngClass]="{ 'text-green-500': passwordRequirements.number, 'text-red-500': !passwordRequirements.number }">
          <small>Debe tener al menos un número (0-9)</small>
        </li>
        <li [ngClass]="{ 'text-green-500': passwordRequirements.specialChar, 'text-red-500': !passwordRequirements.specialChar }">
          <small>Debe tener al menos un carácter especial (!&#64;#$%^&amp;*(), etc.)</small>
        </li>
      </ul>

      <div *ngIf="f['password'].invalid && f['password'].touched" class="text-red-500 mt-1">
        <small *ngIf="f['password'].errors?.['required']">La contraseña es obligatoria.</small>
        <small *ngIf="f['password'].errors?.['pattern']">Caracteres no permitidos en la contraseña.</small>
        <small *ngIf="f['password'].errors?.['commonPassword']">
          No se permite usar patrones comunes como "12345" o "password".
        </small>
        <small *ngIf="f['password'].errors?.['passwordStrength']">
          La contraseña no cumple con los requisitos.
        </small>
      </div>

      <div class="mb-4">
        <label class="block text-pci-blue font-bold mb-2" for="confirmPassword">Confirmar contraseña</label>
        <div class="relative">
          <input
            formControlName="confirmPassword"
            id="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            placeholder="Confirma tu contraseña"
            class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-pci-blue"
          />
          <button
            type="button"
            class="absolute right-2 top-2 text-gray-500 hover:text-gray-700 focus:outline-none"
            (click)="togglePasswordVisibility('confirmPassword')"
          >
            <fa-icon [icon]="showConfirmPassword ? faEyeSlash : faEye"></fa-icon>
          </button>
        </div>
      </div>

      <div class="flex items-center justify-center">
        <div class="g-recaptcha" id="recaptcha-container" data-sitekey="6LdUFV8qAAAAACkMDvyHFVmW9W5EVjMBov_LGyMQ" data-callback="onCaptchaResolved"></div>
      </div>

      <div class="flex items-center justify-between mt-6">
        <button
          class="w-full bg-pci-blue text-white font-bold py-2 px-4 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
          type="submit"
          [disabled]="registerForm.invalid"
        >
          Registrarse
        </button>
      </div>
    </form>
  </div>
</div>
